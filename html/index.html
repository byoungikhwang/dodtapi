<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>From Zero to LOUD - AI Fashion Creator</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Lucide Icons 로드 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 기본 스타일 설정 및 Inter 폰트 적용 */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a0033; /* 매우 깊은 보라색 배경 */
            color: #ffffff;
            line-height: 1.6;
        }
        /* 스플래시 이미지의 네온 효과 */
        .neon-text {
            text-shadow: 0 0 5px #f0f, 0 0 10px #f0f, 0 0 20px #f0f; /* 네온 효과 강화 */
        }
        /* 네온 원형 테두리 */
        .neon-circle-border {
            border: 3px solid #f0f;
            box-shadow: 0 0 15px #f0f, 0 0 25px rgba(255, 0, 255, 0.5);
            position: relative; 
            z-index: 10; 
        }
        /* 액티브 탭 하이라이트 */
        .tab-highlight {
            height: 4px;
            background-color: #06B6D4; /* 밝은 시안색 */
            position: absolute;
            bottom: 0;
            transition: left 0.3s ease, width 0.3s ease;
        }
        /* 트렌디한 카드 배경 그라데이션 */
        .trend-card-bg {
            background: linear-gradient(145deg, #5B21B5 10%, #7C3Aed 90%);
        }
        /* 버튼 스타일 */
        .cyan-button {
            background-color: #06B6D4; /* 밝은 시안색 */
            color: #1a0033;
            transition: background-color: 0.3s;
        }
        .cyan-button:hover {
            background-color: #0891b2; 
        }

        /* 헤더 배경 스타일: 배경 이미지와 높이 추가 */
        .splash-bg {
            background-color: #1a0033; /* Fallback */
            min-height: 35vh; /* 높이를 25vh에서 35vh로 증가 */
            display: flex; /* flex를 사용하여 콘텐츠를 중앙에 배치 */
            flex-direction: column;
            justify-content: space-between;
            position: relative;
            overflow: hidden;

            /* 배경 이미지 추가 (네온 그리드 Placeholder) */
            background-image: url('../image/main.png'); /* 첨부된 이미지 파일 이름으로 변경 */
            background-size: cover;
            background-position: center;
        }

        /* 배경 이미지 위에 짙은 반투명 오버레이를 추가하여 텍스트 가독성 높이기 */
        .splash-bg::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5); /* 짙은 반투명 오버레이 */
            z-index: 1; /* 콘텐츠(z-10, z-20) 아래에 위치 */
        }
        
        /* 로그인 입력 필드 및 텍스트 스타일 개선 */
        .login-input {
            background-color: #4c1d95;
            border: 1px solid #6366f1;
            color: #ffffff;
        }
        .login-input::placeholder {
            color: #ccc;
        }

        /* 이미지 업로드 영역 스타일 */
        .upload-area {
            border: 2px dashed #6366f1;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .upload-area:hover {
            border-color: #06B6D4;
            background-color: #312e81;
        }
        .image-preview {
            max-width: 100%;
            height: auto;
            max-height: 250px;
            object-fit: contain;
        }
        
        /* 마이페이지 생성 이력 이미지 스타일 */
        .history-image {
            height: 250px;
            object-fit: cover;
        }

        /* Inner tab styles */
        .inner-tab-button {
            background-color: transparent;
            color: white;
            transition: background-color 0.3s, color 0.3s;
        }
        .inner-tab-button.active {
            background-color: #06B6D4;
            color: #1a0033;
        }
        .inner-tab-content {
            display: none;
        }
        .inner-tab-content.active {
            display: block;
        }
        .image-bg-section {
            background-image: url('../image/main_1.png');
            background-size: cover;
            background-position: center;
        }
        
    </style>
</head>
<body>

    <div id="app" class="min-h-screen">
        
        <!-- 1. Header & Splash Section -->
        <header class="splash-bg relative flex flex-col justify-between p-6">
            <!-- Top Navigation -->
            <!-- z-index 20으로 오버레이(z-1) 위에 위치 -->
            <nav class="flex justify-end text-sm font-medium space-x-4 text-white/90 z-20">
                <!-- [변경됨] navigateTo 함수를 사용하여 페이지 이동 구현 -->
                <a href="login.html" class="hover:text-cyan-400">Login</a>
                <span class="text-gray-400">/</span>
                <a href="#" onclick="navigateTo('mypage')" class="hover:text-cyan-400">My Page</a>
                <span class="text-gray-400">/</span>
                <a href="#" onclick="navigateTo('trend')" class="hover:text-cyan-400">Trend</a>
                <span class="text-gray-400">/</span>
                <a href="#" onclick="navigateTo('ai')" class="hover:text-cyan-400">AI</a>
                <span class="text-gray-400">/</span>
                <a href="#" onclick="navigateTo('trend')" class="hover:text-cyan-400">Home</a>
            </nav>

            <!-- Splash Text (로고) -->
            <!-- z-index 10으로 오버레이(z-1) 위에 위치 -->
            <div class="flex flex-col items-center justify-center h-full my-auto relative z-10"> 
                <div class="neon-circle-border p-6 rounded-full w-fit">
                    <h1 class="text-5xl md:text-7xl font-extrabold text-white text-center neon-text tracking-widest leading-tight">
                        From Zero<br>to LOUD
                    </h1>
                </div>
            </div>
        </header>

        <main class="container mx-auto px-4 py-8 max-w-7xl">
            
            <!-- 페이지 섹션 1: 메인 콘텐츠 (로그인, 탭, 피드, 코디 생성) - 기본 페이지 -->
            <div id="trend" class="page-section">
                


                <!-- 3. Navigation Tabs -->
                <section class="mb-8">
                    <div class="tabs-container rounded-t-xl rounded-b-lg p-1 shadow-2xl relative">
                        <div id="tabs" class="flex justify-around relative">
                            <button data-tab="trend-feed" class="tab-button flex-1 p-3 text-white font-semibold transition-all duration-300 hover:text-cyan-400 relative">
                                OOTD
                            </button>
                            <button data-tab="create-coordi" class="tab-button flex-1 p-3 text-white font-semibold transition-all duration-300 hover:text-cyan-400 relative">
                                Beginner
                            </button>
                            <button data-tab="results" class="tab-button flex-1 p-3 text-white font-semibold transition-all duration-300 hover:text-cyan-400 relative">
                                Trendy
                            </button>
                            <!-- Active Tab Highlight Bar -->
                            <div id="tab-indicator" class="tab-highlight"></div>
                        </div>
                    </div>
                </section>
                
                <!-- 4. Tab Content Area -->
                <div id="tab-content" class="min-h-[40vh] p-4">
                    
                    <!-- Tab 1: 오늘의 트렌드 의상 피드 (Default Active) -->
                    <div id="trend-feed" class="tab-page">
                        <h2 class="text-2xl font-bold mb-6 text-center border-b border-indigo-500/50 pb-2">데일리 트렌드 피드</h2>
                        <p class="text-center text-gray-300 mb-8">마음에 드는 트렌드를 선택하고 '나만의 코디 생성하기' 탭으로 이동하여 스타일을 요청하세요.</p>

                        <!-- New Inner Tab Section -->
                        <div class="image-bg-section p-6 rounded-xl shadow-2xl relative">
                            <div class="absolute inset-0 bg-black opacity-50 rounded-xl"></div>
                            <div class="relative z-10">
                                <!-- <div class="flex justify-center mb-4">
                                    <button class="inner-tab-button p-2 px-4 rounded-l-lg active" onclick="openInnerTab('ootd')">OOTD</button>
                                    <button class="inner-tab-button p-2 px-4" onclick="openInnerTab('beginner')">Beginner</button>
                                    <button class="inner-tab-button p-2 px-4 rounded-r-lg" onclick="openInnerTab('trendy')">Trendy</button>
                                </div>
                                <div id="ootd" class="inner-tab-content active p-4 text-center">
                                    <h3 class="text-xl font-bold mb-2">OOTD (Outfit of the Day)</h3>
                                    <p>오늘의 추천 스타일입니다. 매일 업데이트되는 새로운 코디를 확인하세요.</p>
                                </div>
                                <div id="beginner" class="inner-tab-content p-4 text-center">
                                    <h3 class="text-xl font-bold mb-2">Beginner's Guide</h3>
                                    <p>패션 초보자를 위한 기본 아이템과 스타일링 팁을 제공합니다.</p>
                                </div>
                                <div id="trendy" class="inner-tab-content p-4 text-center">
                                    <h3 class="text-xl font-bold mb-2">Trendy Styles</h3>
                                    <p>최신 패션 트렌드를 반영한 핫한 아이템들을 만나보세요.</p>
                                </div> -->
                            </div>
                        </div>
                    </div>

                    <!-- Tab 2: 나만의 코디 생성하기 (Image-to-Image / 스타일 전송) -->
                    <div id="create-coordi" class="tab-page hidden p-4 sm:p-8 bg-indigo-900/40 rounded-xl shadow-inner">
                        <h2 class="text-2xl font-bold mb-6 text-center border-b border-indigo-500/50 pb-2">나만의 AI 코디 생성</h2>
                        <p class="text-center text-gray-300 mb-8">
                            **이미지-투-이미지 스타일 전송**: 내 사진을 업로드하고, 원하는 컨셉(배역/스타일)을 입력하여 AI 코디를 생성해 보세요.
                        </p>

                        <div class="flex flex-col md:flex-row gap-6">
                            <!-- 1. 이미지 업로드 섹션 -->
                            <div class="md:w-1/2">
                                <label class="block text-lg font-medium mb-3">1. 내 사진 업로드 (첫 번째 이미지)</label>
                                <p class="text-sm text-gray-400 mb-3">AI가 코디를 입힐 인물 사진을 업로드하세요. (정면 사진 권장)</p>
                                
                                <div class="upload-area p-4 rounded-xl flex flex-col items-center justify-center min-h-[250px] bg-indigo-900/50 cursor-pointer" onclick="document.getElementById('file-input').click()">
                                    <input type="file" id="file-input" accept="image/*" class="hidden" onchange="previewImage(event)">
                                    
                                    <img id="image-preview" class="image-preview hidden rounded-lg mb-2" alt="미리보기">
                                    
                                    <div id="upload-placeholder" class="text-center">
                                        <i data-lucide="image-plus" class="w-8 h-8 text-cyan-400 mb-2 mx-auto"></i>
                                        <p class="text-white font-semibold">클릭하여 이미지 업로드</p>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. 스타일 프롬프트 및 생성 섹션 -->
                            <div class="md:w-1/2">
                                <label for="style-prompt" class="block text-lg font-medium mb-3">2. 원하는 스타일/배역 프롬프트 입력 (두 번째 이미지 컨셉)</label>
                                <textarea id="style-prompt" rows="6" placeholder="예시: 고급스러운 이브닝 드레스, 미래적인 사이버펑크 스타일의 수트, 또는 중세 시대 기사의 갑옷"
                                          class="w-full p-3 rounded-lg login-input focus:ring-cyan-400 focus:border-cyan-400 resize-none"></textarea>
                                
                                <button id="generate-button" onclick="generateCoordi()" class="w-full p-3 mt-4 font-bold rounded-xl cyan-button flex items-center justify-center space-x-2 disabled:bg-gray-500 disabled:cursor-not-allowed" disabled>
                                    <i data-lucide="sparkles" class="w-5 h-5 inline-block"></i>
                                    <span>AI 코디 생성 요청</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- 3. 결과 영역 -->
                        <div class="mt-8 p-6 rounded-xl bg-indigo-900 shadow-2xl">
                            <h3 class="text-xl font-semibold mb-4 border-b border-cyan-400/50 pb-2">AI 코디 결과</h3>
                            <div id="loading-indicator" class="text-center py-12 hidden">
                                <svg class="animate-spin h-8 w-8 text-cyan-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                                <p class="mt-3 text-cyan-400">AI가 스타일을 전송 중입니다. 잠시만 기다려 주세요...</p>
                            </div>
                            <div id="result-image-container" class="text-center py-4">
                                <img id="result-image" class="image-preview mx-auto rounded-lg shadow-lg hidden" alt="생성된 코디 이미지">
                                <p id="result-message" class="text-gray-400">사진을 업로드하고 스타일을 입력해 주세요.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Tab 3: 결과물 콘솔 -->
                    <div id="results" class="tab-page hidden p-8 text-center bg-indigo-900/40 rounded-xl shadow-inner">
                        <p class="text-xl text-gray-300">결과물 콘솔 탭입니다. 생성된 코디 결과 이미지들을 보여주는 갤러리 기능을 여기에 구현할 예정입니다.</p>
                        <button class="mt-4 p-3 bg-fuchsia-600 rounded-xl hover:bg-fuchsia-700 font-bold">내 결과물 보기</button>
                    </div>
                </div>

                <!-- "나만의 코디 생성하러 가기" Button Section -->
                <section class="mt-12 text-center">
                    <button onclick="goToCreateCoordi()" class="p-4 px-8 font-bold rounded-xl cyan-button text-lg">
                        나만의 코디 생성하러 가기
                    </button>
                </section>
            </div>
            
            <!-- 페이지 섹션 2: 마이 페이지 (My Page) -->
            <div id="mypage" class="page-section hidden p-8 bg-indigo-900/40 rounded-xl shadow-2xl">
                <h2 class="text-4xl font-extrabold mb-8 text-cyan-400">My Page</h2>
                
                <!-- 사용자 정보 섹션 -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 border-b border-indigo-500/50 pb-6">
                    <div class="font-bold text-lg text-gray-300">이름</div>
                    <div class="md:col-span-2 text-xl font-medium text-white">@@@</div>
                    
                    <div class="font-bold text-lg text-gray-300">이메일</div>
                    <div class="md:col-span-2 text-xl font-medium text-white">abc12345@gmail.com</div>
                    
                    <div class="font-bold text-lg text-gray-300">플랜</div>
                    <div class="md:col-span-2 text-xl font-medium text-white">Basic</div>
                </div>
                
                <!-- 생성 이력 영상 (갤러리) 섹션 -->
                <h3 class="text-2xl font-bold mb-6 border-b border-cyan-400/50 pb-2">생성 이력 영상</h3>
                
                <!-- Mockup Images (2.jpg 참조) -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="rounded-xl overflow-hidden shadow-lg border border-indigo-500/50">
                        <img src="https://placehold.co/400x400/312e81/ffffff?text=Generated+Image+1" alt="생성이미지 1" class="w-full history-image">
                        <div class="p-3 text-sm text-center bg-indigo-900/70">Urban Chic Style</div>
                    </div>
                    <div class="rounded-xl overflow-hidden shadow-lg border border-indigo-500/50">
                        <img src="https://placehold.co/400x400/312e81/ffffff?text=Generated+Image+2" alt="생성이미지 2" class="w-full history-image">
                        <div class="p-3 text-sm text-center bg-indigo-900/70">European Classic Style</div>
                    </div>
                    <div class="rounded-xl overflow-hidden shadow-lg border border-indigo-500/50">
                        <img src="https://placehold.co/400x400/312e81/ffffff?text=Generated+Image+3" alt="생성이미지 3" class="w-full history-image">
                        <div class="p-3 text-sm text-center bg-indigo-900/70">Cyberpunk Leather Look</div>
                    </div>
                </div>
            </div>
            
            <!-- 페이지 섹션 3: AI 설명 페이지 (임시) -->
            <div id="ai" class="page-section hidden p-8 text-center bg-indigo-900/40 rounded-xl shadow-inner">
                <h2 class="text-4xl font-extrabold mb-8 text-cyan-400">AI 소개 페이지</h2>
                <p class="text-xl text-gray-300">이곳은 AI 기술과 이미지-투-이미지 생성 원리를 설명하는 페이지입니다.</p>
                <button onclick="navigateTo('trend')" class="mt-4 p-3 bg-fuchsia-600 rounded-xl hover:bg-fuchsia-700 font-bold">메인 페이지로 돌아가기</button>
            </div>


        </main>
    </div>

    <script>
        // 상수 및 유틸리티 함수
        const API_KEY = ""; // 캔버스 환경에서 자동 제공
        const IMAGE_GEN_URL = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${API_KEY}`;
        
        let currentPage = 'trend'; // 현재 활성화된 페이지 상태

        // Base64 인코딩 함수 (File to Base64)
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]); 
                reader.onerror = error => reject(error);
            });
        }
        
        // [추가됨] 페이지 이동 함수
        function navigateTo(targetPage) {
            currentPage = targetPage;
            const pageSections = document.querySelectorAll('.page-section');
            
            pageSections.forEach(section => {
                if (section.id === targetPage) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }
            });

            // 페이지가 전환되면 탭 인디케이터 초기화 (메인 페이지로 돌아갈 때만)
            // initializeTabs 함수가 전역 스코프에 정의되었으므로 이제 안전하게 호출 가능
            if (targetPage === 'trend') {
                initializeTabs(); 
            }
            // 아이콘 새로고침
            lucide.createIcons();
        }

        // [수정됨] 탭 초기화 및 인디케이터 위치 설정 함수 (전역 스코프)
        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabIndicator = document.getElementById('tab-indicator');
            const initialButton = document.querySelector(`.tab-button[data-tab="trend-feed"]`);

            if (initialButton) {
                // 최초 로드 시 인디케이터 초기 위치를 즉시 설정 (transition 없이)
                const rect = initialButton.getBoundingClientRect();
                const parentRect = initialButton.closest('#tabs').getBoundingClientRect();
                
                // 일시적으로 transition 끄기
                tabIndicator.style.transition = 'none'; 
                tabIndicator.style.left = `${rect.left - parentRect.left}px`;
                tabIndicator.style.width = `${rect.width}px`;
                
                // 짧은 딜레이 후 transition 다시 켜기
                setTimeout(() => {
                    tabIndicator.style.transition = 'left 0.3s ease, width 0.3s ease'; 
                }, 50);
                
                setActiveTab('trend-feed');
            }
        }
        
        // 탭 활성화 로직
        function setActiveTab(tabId) {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabIndicator = document.getElementById('tab-indicator');
            const tabPages = document.querySelectorAll('.tab-page');
            
            // 1. 페이지 숨기기/보이기
            tabPages.forEach(page => {
                page.classList.add('hidden');
                if (page.id === tabId) {
                    page.classList.remove('hidden');
                }
            });

            // 2. 버튼 스타일 업데이트 및 인디케이터 이동
            tabButtons.forEach(button => {
                const isActive = button.getAttribute('data-tab') === tabId;
                
                if (isActive) {
                    const rect = button.getBoundingClientRect();
                    const parentRect = button.closest('#tabs').getBoundingClientRect();
                    
                    tabIndicator.style.left = `${rect.left - parentRect.left}px`;
                    tabIndicator.style.width = `${rect.width}px`;
                    
                    button.classList.add('text-cyan-400'); 
                } else {
                    button.classList.remove('text-cyan-400');
                }
            });
            
            // 탭이 전환된 후 아이콘 다시 생성 (필요한 경우)
            lucide.createIcons();
        }

        // Inner tab logic
        function openInnerTab(tabName) {
            document.querySelectorAll('.inner-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.inner-tab-button').forEach(button => {
                button.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        function goToCreateCoordi() {
            setActiveTab('create-coordi');
            window.scrollTo(0, 0);
        }

        // 이미지 미리보기 및 버튼 활성화
        function previewImage(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('image-preview');
            const placeholder = document.getElementById('upload-placeholder');
            const generateButton = document.getElementById('generate-button');
            const resultMessage = document.getElementById('result-message');

            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                    generateButton.disabled = false;
                    resultMessage.textContent = '스타일을 입력하고 생성 버튼을 눌러주세요.';
                };
                reader.readAsDataURL(file);
            } else {
                preview.src = '';
                preview.classList.add('hidden');
                placeholder.classList.remove('hidden');
                generateButton.disabled = true;
                resultMessage.textContent = '사진을 업로드하고 스타일을 입력해 주세요.';
            }
        }


        // AI 코디 생성 요청 함수 (스타일 전송)
        async function generateCoordi() {
            const fileInput = document.getElementById('file-input');
            const promptInput = document.getElementById('style-prompt');
            const loadingIndicator = document.getElementById('loading-indicator');
            const resultImage = document.getElementById('result-image');
            const resultMessage = document.getElementById('result-message');
            const generateButton = document.getElementById('generate-button');

            if (fileInput.files.length === 0 || !promptInput.value.trim()) {
                alertMessage('사진과 스타일 프롬프트를 모두 입력해주세요.');
                return;
            }

            // UI 상태 초기화 및 로딩 시작
            resultImage.classList.add('hidden');
            resultMessage.textContent = '';
            loadingIndicator.classList.remove('hidden');
            generateButton.disabled = true;

            const userPrompt = promptInput.value.trim();
            const sourceFile = fileInput.files[0];
            
            try {
                // 1. 원본 이미지를 Base64로 인코딩
                const base64Image = await fileToBase64(sourceFile);

                // 2. API Payload 구성 (Image-to-Image Generation)
                const payload = {
                    instances: [
                        {
                            prompt: userPrompt,
                            inputImage: {
                                imageBytes: base64Image
                            }
                        }
                    ],
                    parameters: {
                        "sampleCount": 1 
                    }
                };

                // 3. API 호출 (지수 백오프 적용)
                let response;
                const maxRetries = 3;
                let delay = 1000;

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        response = await fetch(IMAGE_GEN_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) break; 
                        
                        if (i < maxRetries - 1) {
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2; 
                        } else {
                            throw new Error('API 호출 실패: ' + response.statusText);
                        }

                    } catch (error) {
                        if (i < maxRetries - 1) {
                            await new Promise(res => setTimeout(res, delay));
                            delay *= 2;
                        } else {
                            throw error;
                        }
                    }
                }
                
                if (!response || !response.ok) throw new Error('API 응답 수신 실패');
                
                const result = await response.json();
                
                // 4. 결과 이미지 Base64 데이터 추출
                const base64Data = result?.predictions?.[0]?.bytesBase64Encoded;

                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    resultImage.src = imageUrl;
                    resultImage.classList.remove('hidden');
                    resultMessage.textContent = 'AI 코디 생성 완료!';
                } else {
                    resultMessage.textContent = '이미지 생성에 실패했습니다. (응답 데이터 오류)';
                    console.error("AI Response Error:", result);
                }

            } catch (error) {
                resultMessage.textContent = `오류 발생: ${error.message}`;
                console.error("Error generating image:", error);
            } finally {
                loadingIndicator.classList.add('hidden');
                generateButton.disabled = false;
                lucide.createIcons();
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            // Lucide icons 초기화 (아이콘 렌더링)
            lucide.createIcons();
            
            // 페이지 로드 시 'trend' 페이지를 기본으로 설정
            navigateTo('trend'); 

            // 탭 버튼 클릭 핸들러
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTabId = button.getAttribute('data-tab');
                    setActiveTab(targetTabId);
                });
            });

            // 창 크기가 변경될 때 인디케이터 위치 재조정 (반응형 대응)
            window.addEventListener('resize', initializeTabs);
            
            // 초기화 호출 (페이지 로드 시)
            initializeTabs();
            // Inner tab 초기화
            openInnerTab('ootd');
        });

        // Mock Login Handler
        function handleLogin(event, type) {
            event.preventDefault();
            const uidStatus = document.getElementById('uid_status');
            let uid = 'UID_default_user';

            if (type === 'classic') {
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                if (!username || !password) {
                    alertMessage('아이디와 비밀번호를 입력해주세요.');
                    return;
                }
                uid = `UID_${username.substring(0, 5)}`;
                alertMessage(`일반 로그인 시도: ${username}`);
            } else if (type === 'google') {
                uid = `UID_google_${Math.random().toString(16).substring(2, 8)}`;
                alertMessage('Google 간편 로그인 시도 중...');
            }
            
            uidStatus.textContent = `UID: ${uid} (로그인 완료)`;
            uidStatus.classList.remove('text-cyan-400', 'text-red-400');
            uidStatus.classList.add('text-green-400');
        }

        // Mock Trend Selection Handler
        function selectTrend(trendName) {
            alertMessage(`${trendName}을(를) 선택했습니다. 이제 '나만의 코디 생성하기' 탭으로 이동하세요!`);
            // 탭 자동 전환 기능
            setActiveTab('create-coordi'); 
        }

        // Custom Alert Message (alert() 대신 사용)
        function alertMessage(message) {
            console.log("ALERT:", message); // 콘솔에 로그 출력
            const app = document.getElementById('app');
            let msgBox = document.getElementById('custom-alert');

            if (!msgBox) {
                msgBox = document.createElement('div');
                msgBox.id = 'custom-alert';
                msgBox.className = 'fixed top-4 right-4 z-50 p-4 rounded-lg shadow-xl text-white bg-indigo-700 transition-opacity duration-300 opacity-0';
                app.appendChild(msgBox);
            }

            msgBox.textContent = message;
            msgBox.classList.remove('opacity-0');
            msgBox.classList.add('opacity-100');

            setTimeout(() => {
                msgBox.classList.remove('opacity-100');
                msgBox.classList.add('opacity-0');
            }, 3000);
        }

        // 페이지 로드 후 Lucide 아이콘 다시 생성 (DOM 조작 후 필요할 수 있음)
        window.onload = () => {
            lucide.createIcons();
        };

    </script>
</body>
</html>
