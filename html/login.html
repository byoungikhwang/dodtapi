<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 - From Zero to LOUD</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons 로드 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- React & Babel 로드 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const App = () => {
            const { useState, useEffect } = React;

            const [isLogin, setIsLogin] = useState(true);
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [message, setMessage] = useState('');
            const [loading, setLoading] = useState(false);

            const BACKEND_URL = "http://127.0.0.1:5000"; // 백엔드 서버 주소

            // 아이콘을 다시 렌더링하기 위한 useEffect
            useEffect(() => {
                lucide.createIcons();
            }, [loading, isLogin, message]);

            // --- 새로운 Google 로그인 핸들러 ---
            const handleGoogleLogin = async (e) => {
                e.preventDefault();
                // Google 로그인은 이메일만 사용합니다.
                if (!email) {
                    setMessage('백엔드와 연동하려면 이메일 주소를 입력해주세요.');
                    return;
                }
                
                setLoading(true);
                setMessage('');

                try {
                    const response = await fetch(`${BACKEND_URL}/login/google`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email: email }),
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // 성공적으로 응답을 받았을 때
                        setMessage(data.message || '로그인 성공! 환영합니다.');
                        console.log('로그인 성공:', data);
                        // 성공 시 1.5초 후 메인 페이지로 이동
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 1500);
                    } else {
                        // 서버가 에러 응답을 보냈을 때
                        setMessage(data.error || '로그인 중 오류가 발생했습니다.');
                    }
                } catch (error) {
                    // 네트워크 오류 등 fetch 자체가 실패했을 때
                    console.error('Fetch Error:', error);
                    setMessage('서버에 연결할 수 없습니다. 백엔드 서버가 실행 중인지 확인해주세요.');
                } finally {
                    setLoading(false);
                }
            };

            // 시뮬레이션된 기존 인증 함수 (참고용으로 남겨둠)
            const handleAuth = (e) => {
                e.preventDefault();
                setLoading(true);
                setMessage('');
                
                if (!email || !password) {
                    setMessage('이메일과 비밀번호를 모두 입력해주세요.');
                    setLoading(false);
                    return;
                }

                setTimeout(() => {
                    setLoading(false);
                    if (isLogin) {
                        if (email.endsWith('@success.com') && password === '1234') { 
                            setMessage(`'${email}'로 로그인 성공! 환영합니다.`);
                            setTimeout(() => { window.location.href = 'index.html'; }, 1500);
                        } else {
                            setMessage('로그인 실패: 이메일 또는 비밀번호가 올바르지 않습니다.');
                        }
                    } else {
                        setMessage(`'${email}'로 회원가입 성공! 이제 로그인해주세요.`);
                        setEmail('');
                        setPassword('');
                        setIsLogin(true); 
                    }
                }, 1500);
            };

            const handleHome = () => {
                window.location.href = 'index.html';
            };

            return (
                <div className="min-h-screen bg-indigo-950 flex flex-col items-center justify-center p-4 sm:p-6 font-sans">
                    <div className="w-full max-w-md bg-indigo-900 rounded-xl shadow-xl p-6 sm:p-8 transition-all duration-300">
                        <h1 className="text-3xl font-extrabold text-white mb-2 text-center">
                            {isLogin ? '로그인' : '회원가입'}
                        </h1>
                        <p className="text-center text-sm text-gray-400 mb-8">
                            계정을 이용하여 서비스를 시작해보세요.
                        </p>

                        {message && (
                            <div 
                                className={`p-3 mb-4 text-sm rounded-lg ${
                                    message.includes('성공') 
                                    ? 'bg-green-100 text-green-800 border border-green-300'
                                    : 'bg-red-100 text-red-800 border border-red-300'
                                }`}
                                role="alert"
                            >
                                {message}
                            </div>
                        )}

                        {/* --- 이메일 입력은 Google 로그인과 공유 --- */}
                        <div className="relative mb-4">
                            <i data-lucide="mail" className="absolute top-1/2 left-3 transform -translate-y-1/2 h-5 w-5 text-gray-400"></i>
                            <input
                                type="email"
                                placeholder="이메일 주소"
                                required
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                className="w-full pl-10 pr-4 py-3 bg-indigo-800 text-white border border-indigo-600 rounded-lg focus:ring-cyan-500 focus:border-cyan-500 transition duration-150 ease-in-out"
                                disabled={loading}
                            />
                        </div>

                        {/* --- Google 로그인 버튼 --- */}
                        <button
                            onClick={handleGoogleLogin}
                            className="w-full flex items-center justify-center space-x-2 py-3 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-150 ease-in-out disabled:opacity-60"
                            disabled={loading}
                        >
                            {loading ? (
                                <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                    <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                    <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                </svg>
                            ) : (
                                <><i data-lucide="log-in" className="h-5 w-5"></i><span>Google 계정으로 로그인</span></>
                            )}
                        </button>
                        
                        <div class="my-4 flex items-center before:mt-0.5 before:flex-1 before:border-t before:border-neutral-300 after:mt-0.5 after:flex-1 after:border-t after:border-neutral-300">
                            <p class="mx-4 mb-0 text-center font-semibold text-slate-300">OR</p>
                        </div>


                        {/* --- 기존 이메일/비밀번호 폼 (이제 사용되지 않음) --- */}
                        <form onSubmit={handleAuth} className="space-y-4 hidden">
                            <div className="relative">
                                <i data-lucide="lock" className="absolute top-1/2 left-3 transform -translate-y-1/2 h-5 w-5 text-gray-400"></i>
                                <input
                                    type="password"
                                    placeholder="비밀번호"
                                    required
                                    value={password}
                                    onChange={(e) => setPassword(e.g.target.value)}
                                    className="w-full pl-10 pr-4 py-3 bg-indigo-600 border border-indigo-600 rounded-lg focus:ring-cyan-500 focus:border-cyan-500 focus:bg-white transition duration-150 ease-in-out"
                                    disabled={loading}
                                />
                            </div>

                            <button
                                type="submit"
                                className="w-full flex items-center justify-center space-x-2 py-3 px-4 border border-transparent rounded-lg shadow-md text-base font-medium text-white bg-cyan-600 hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 transition duration-150 ease-in-out disabled:opacity-60"
                                disabled={loading}
                            >
                                {!loading && (isLogin ? 
                                    <><i data-lucide="log-in" className="h-5 w-5"></i><span>로그인</span></> : 
                                    <><i data-lucide="user-plus" className="h-5 w-5"></i><span>회원가입</span></>)}
                            </button>
                        </form>

                        {/* --- 회원가입 전환 링크 (숨김 처리) --- */}
                    <div className="mt-6 w-full max-w-md">
	                    <button
		                    onClick={handleHome}
		                    disabled={loading}
    		                className="w-full h-24 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all overflow-hidden">
	    	                <img src="../image/home.png" alt="홈" className="w-full h-full object-cover" />
	                    </button>
                    </div>

                    <div className="mt-6 w-full max-w-md">
                        <button
                            onClick={handleHome}
                            className="w-full flex items-center justify-center space-x-2 py-3 px-4 border border-indigo-600 rounded-lg shadow-sm text-base font-medium text-gray-200 bg-indigo-900 hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500 transition duration-150 ease-in-out disabled:opacity-60"
                            disabled={loading}
                        >
                            <i data-lucide="home" className="h-5 w-5"></i>
                            <span>홈으로</span>
                        </button>
                    </div>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

        // 초기 아이콘 렌더링
        lucide.createIcons();
    </script>
</body>
</html>
