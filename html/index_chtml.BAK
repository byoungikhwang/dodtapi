<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>From Zero to LOUD - AI Fashion Creator</title>
    <!-- 외부 라이브러리 로드: Tailwind CSS, Google Fonts, Lucide Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* --- 기본 및 전역 스타일 --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff; /* 깊은 보라색 배경 */
            color: #ffffff;
            line-height: 1.6;
        }

        /* --- UI 컴포넌트 스타일 --- */
        /* 메인 헤더의 네온 효과 텍스트 */
        .neon-text {
            text-shadow: 0 0 5px #f0f, 0 0 10px #f0f, 0 0 20px #f0f;
        }
        /* 로고 주위의 네온 효과 테두리 */
        .neon-circle-border {
            border: 3px solid #f0f;
            box-shadow: 0 0 15px #f0f, 0 0 25px rgba(255, 0, 255, 0.5);
            position: relative; 
            z-index: 10; 
        }
        /* 탭 네비게이션 활성 탭 표시줄 */
        .tab-highlight {
            height: 4px;
            background-color: #06B6D4; /* 시안색 */
            position: absolute;
            bottom: 0;
            transition: left 0.3s ease, width 0.3s ease;
        }
        /* 주요 액션 버튼 스타일 */
        .cyan-button {
            background-color: #06B6D4;
            color: #1a0033;
            transition: all 0.3s;
        }
        .cyan-button:hover {
            background-color: #0891b2; 
            transform: scale(1.02);
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.4);
        }
        .cyan-button:disabled {
            background-color: #4b5563;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* 헤더 배경 위 텍스트 가독성을 위한 오버레이 */
        .splash-bg::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1;
        }
        
        /* --- 'Create' 탭 내부 스타일 --- */
        /* 텍스트 입력 필드 */
        .login-input {
            background-color: #312e81;
            border: 1px solid #6366f1;
            color: #ffffff;
            transition: border-color 0.3s;
        }
        .login-input:focus {
            outline: none;
            border-color: #06B6D4;
            box-shadow: 0 0 0 2px rgba(6, 182, 212, 0.2);
        }
        .login-input::placeholder {
            color: #9ca3af;
        }
        /* 이미지 업로드 영역 */
        .upload-area {
            border: 2px dashed #6366f1;
            transition: all 0.3s;
            background-color: rgba(49, 46, 129, 0.4);
        }
        .upload-area:hover {
            border-color: #06B6D4;
            background-color: rgba(49, 46, 129, 0.8);
        }
        /* 프롬프트 추천 옵션 칩 */
        .option-chip {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #d1d5db;
            padding: 0.5rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .option-chip:hover {
            background-color: #06B6D4;
            border-color: #06B6D4;
            color: #1a0033;
            font-weight: bold;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .option-chip:active { transform: translateY(0); }
        .option-chip.selected { /* 클릭 시 잠시 활성화되는 시각적 피드백 */
            background-color: #06B6D4;
            border-color: #06B6D4;
            color: #1a0033;
            font-weight: bold;
        }
        /* 성별 선택 라디오 버튼 */
        .gender-radio:checked + label {
            background-color: #06B6D4;
            color: #1a0033;
            font-weight: bold;
            border-color: #06B6D4;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.3);
        }
        /* 아코디언 메뉴 (상세 옵션) */
        details > summary {
            list-style: none;
            cursor: pointer;
        }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary {
            background-color: rgba(255,255,255,0.1);
            border-radius: 0.5rem 0.5rem 0 0;
        }
        
        /* 기타 유틸리티 스타일 */
        .image-preview {
            max-width: 100%;
            height: auto;
            max-height: 250px;
            object-fit: contain;
        }
        .history-image {
            height: 250px;
            object-fit: cover;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a0033; }
        ::-webkit-scrollbar-thumb { background: #4c1d95; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6d28d9; }
    </style>
</head>
<body>

    <!-- 전체 애플리케이션 컨테이너 -->
    <div id="app" class="min-h-screen">
        
        <!-- 1. 페이지 상단 헤더 및 로고 섹션 -->
        <header class="splash-bg relative flex flex-col justify-between p-6">
            <!-- 최상단 네비게이션 링크 -->
            <nav class="flex justify-end text-sm font-medium space-x-4 text-white/90 z-20">
                <a href="login.html" class="hover:text-cyan-400">Login</a>
                <span class="text-gray-400">/</span>
                <a href="mypage.html" class="hover:text-cyan-400">My Page</a>
                <span class="text-gray-400">/</span>
                <a href="#" onclick="navigateTo('trend')" class="hover:text-cyan-400">Trend</a>
                <span class="text-gray-400">/</span>
                <a href="#" onclick="navigateTo('ai')" class="hover:text-cyan-400">AI</a>
                <span class="text-gray-400">/</span>
                <a href="#" onclick="navigateTo('trend')" class="hover:text-cyan-400">Home</a>
            </nav>

        </header>

        <!-- [수정된 부분] 페이지 이동 버튼 그룹: 모든 버튼 사이즈(flex-1, h-24) 동일하게 통일 -->
        <section class="mt-12">
            <div class="flex flex-wrap justify-center items-stretch gap-3 sm:gap-4 max-w-4xl mx-auto">
                <!-- 1. 라이브러리: flex-1, h-24 적용 -->
                <button onclick="navigateTo('results'); setActiveTab('results')" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                    <i data-lucide="library" class="w-6 h-6 mb-2 text-gray-300"></i>
                    <span class="text-xs sm:text-sm text-gray-300 font-bold">라이브러리</span>
                </button>

                <button onclick="navigateTo('trend')" class="flex-1 min-w-[70px] h-24 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all overflow-hidden">
	                <img src="../image/home.png" alt="홈" class="w-full h-full object-cover">
                </button>

                <!-- 3. 코디 생성하기: flex-[2] -> flex-1 변경하여 크기 동일화, h-24 적용 -->
                <button onclick="goToCreateCoordi()" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                    <i data-lucide="shirt" class="w-6 h-6 mb-2 text-gray-300"></i>
                    <span class="text-xs sm:text-sm text-gray-300 font-bold">코디 생성</span>
                </button>

                <!-- 4. 마이페이지: flex-1, h-24 적용 -->
                <button onclick="navigateTo('mypage')" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                    <i data-lucide="user" class="w-6 h-6 mb-2 text-gray-300"></i>
                    <span class="text-xs sm:text-sm text-gray-300 font-bold">마이페이지</span>
                </button>
            </div>
        </section>

        <!-- 2. 메인 콘텐츠 영역 -->
        <main class="container mx-auto px-4 py-8 max-w-7xl">
            
            <!-- 페이지 섹션 1: 기본 콘텐츠 (탭 포함) -->
            <div id="trend" class="page-section">
                
                <!-- 탭 네비게이션 -->
                <section class="mb-8">
                    <div class="tabs-container rounded-t-xl rounded-b-lg p-1 shadow-2xl relative">
                        <div id="tabs" class="flex relative">
                            <button data-tab="trend-feed" class="tab-button flex-1 p-3 text-white font-semibold transition-all duration-300 relative rounded-t-xl">OOTD</button>
                            <div class="relative group flex-1">
                                <button data-tab="beginner" class="tab-button w-full p-3 text-white font-semibold transition-all duration-300 relative rounded-t-xl">Beginner</button>
                                <div class="absolute z-10 hidden group-hover:block bg-indigo-900/90 border border-cyan-500/50 text-white py-2 rounded-lg shadow-xl w-full mt-1">
                                    <a href="#" class="block px-4 py-2 text-sm hover:bg-cyan-400 hover:text-indigo-900 font-semibold">공사중 입니다.</a>
                                </div>
                            </div>

                            <button data-tab="results" class="tab-button flex-1 p-3 text-white font-semibold transition-all duration-300 relative rounded-t-xl">Trendy</button>
                            <div id="tab-indicator" class="tab-highlight"></div>
                        </div>
                    </div>
                </section>
                
                <!-- 탭 콘텐츠 표시 영역 -->
                <div id="tab-content" class="min-h-[40vh] p-6">
                    
                    <!-- 탭 1: OOTD (오늘의 코디 추천) -->
                    <div id="trend-feed" class="tab-page">
                        <h2 class="text-2xl font-bold text-white mb-4">오늘의 코디 추천 (OOTD)</h2>
                        <!-- <p class="text-purple-200 mb-6">AI가 추천하는 데일리 룩을 확인하고 영감을 얻어보세요.</p> -->
                                                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                                        <div class="relative rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-[1.02] cursor-pointer" onclick="toggleZoom(this)">
                                                            <img src="/image/tab_3.png" alt="OOTD Look 1 - Trench Coat" class="w-full h-full object-cover">
                                                            
                                                            <!-- 검정 오버레이 및 해시태그 -->
                                                            <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-3 transition-opacity group-hover:bg-opacity-30">
                                                                <span class="text-xs font-medium text-white p-1 rounded bg-black bg-opacity-50">#클래식</span>
                                                            </div>
                                                            
                                                            <!-- 아이콘 오버레이 -->
                                                            <div class="absolute top-3 right-3 flex items-center gap-3 z-10">
                                                                <!-- 별(저장) 아이콘 -->
                                                                <button class="group/star p-1 rounded-full bg-black/50 hover:bg-black/70 transition-all" onclick="toggleStar(event, this)">
                                                                    <i data-lucide="star" class="w-5 h-5 text-white transition-colors group-hover/star:text-yellow-400"></i>
                                                                </button>
                                                                <!-- 하트(좋아요) 아이콘 -->
                                                                <button class="group/heart p-1 rounded-full bg-black/50 hover:bg-black/70 transition-all flex items-center gap-1" onclick="toggleHeart(event, this)">
                                                                    <i data-lucide="heart" class="w-5 h-5 text-white transition-colors group-hover/heart:text-red-500"></i>
                                                                    <span class="text-xs font-bold text-white">123</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="relative rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-[1.02] cursor-pointer" onclick="toggleZoom(this)">
                                                            <img src="/image/tab_2.png" alt="OOTD Look 2 - Blazer Shorts" class="w-full h-full object-cover">
                                                            
                                                            <!-- 검정 오버레이 및 해시태그 -->
                                                            <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-3 transition-opacity group-hover:bg-opacity-30">
                                                                <span class="text-xs font-medium text-white p-1 rounded bg-black bg-opacity-50">#캐주얼</span>
                                                            </div>
                                                            
                                                            <!-- 아이콘 오버레이 -->
                                                            <div class="absolute top-3 right-3 flex items-center gap-3 z-10">
                                                                <!-- 별(저장) 아이콘 -->
                                                                <button class="group/star p-1 rounded-full bg-black/50 hover:bg-black/70 transition-all" onclick="toggleStar(event, this)">
                                                                    <i data-lucide="star" class="w-5 h-5 text-white transition-colors group-hover/star:text-yellow-400"></i>
                                                                </button>
                                                                <!-- 하트(좋아요) 아이콘 -->
                                                                <button class="group/heart p-1 rounded-full bg-black/50 hover:bg-black/70 transition-all flex items-center gap-1" onclick="toggleHeart(event, this)">
                                                                    <i data-lucide="heart" class="w-5 h-5 text-white transition-colors group-hover/heart:text-red-500"></i>
                                                                    <span class="text-xs font-bold text-white">123</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="relative rounded-xl overflow-hidden shadow-lg transform transition duration-300 hover:scale-[1.02] cursor-pointer" onclick="toggleZoom(this)">
                                                            <img src="/image/tab_1.png" alt="OOTD Look 3 - Neon Leather" class="w-full h-full object-cover">
                                                            
                                                            <!-- 검정 오버레이 및 해시태그 -->
                                                            <div class="absolute inset-0 bg-black bg-opacity-20 flex items-end p-3 transition-opacity group-hover:bg-opacity-30">
                                                                <span class="text-xs font-medium text-white p-1 rounded bg-black bg-opacity-50">#스트릿</span>
                                                            </div>
                                                            
                                                            <!-- 아이콘 오버레이 -->
                                                            <div class="absolute top-3 right-3 flex items-center gap-3 z-10">
                                                                <!-- 별(저장) 아이콘 -->
                                                                <button class="group/star p-1 rounded-full bg-black/50 hover:bg-black/70 transition-all" onclick="toggleStar(event, this)">
                                                                    <i data-lucide="star" class="w-5 h-5 text-white transition-colors group-hover/star:text-yellow-400"></i>
                                                                </button>
                                                                <!-- 하트(좋아요) 아이콘 -->
                                                                <button class="group/heart p-1 rounded-full bg-black/50 hover:bg-black/70 transition-all flex items-center gap-1" onclick="toggleHeart(event, this)">
                                                                    <i data-lucide="heart" class="w-5 h-5 text-white transition-colors group-hover/heart:text-red-500"></i>
                                                                    <span class="text-xs font-bold text-white">123</span>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- Trending Now Section -->
                                                    <div class="mt-8">
                                                        <h3 class="text-xl font-bold text-gray-800">Feed</h3>
                                                            <!-- 1. [Modified] 네이버 패션타운 링크 버튼 (회색 배경, 링크 활성화, 줄바꿈 여백 추가) -->
                                                            <!-- <a href="https://shopping.naver.com/window/main/fashion-group" target="_blank" class="block bg-gray-300 hover:bg-gray-300 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-gray-300/50 p-4 rounded-xl flex items-center justify-between text-black">
                                                                <div>
                                                                    <span class="block text-sm text-black mb-2">트렌디한 패션 정보 및 뉴스들 게시 예정. 현재 db 연결 안되서 텍스트로 넣었습니다.</span>
                                                                    <span class="block text-sm text-black mb-2">베이직으로 뉴트럴 톤 (화이트, 베이지, 문빔 그레이, 모카 무스)이 기본이 됩니다. 봄에는 파스텔톤 (베이비 블루, 라벤더, 크리미 옐로우)이 강세입니다</span>
                                                                    <span class="block text-sm text-black mb-2">생동감을 주는 비비드 블루 스펙트럼 (세룰리안 블루, 딥 블루)과 탠저린(오렌지 계열) 같은 비비드 컬러를 액세서리나 포인트로 활용합니다.</span>
                                                                    <div class="h-10"></div>        
                                                                    <span class="block text-sm text-black">[네이버 최신 패션] 클릭</span>
                                                                    <span class="block text-sm text-cyan-200 mt-1">https://shopping.naver.com/window/main/fashion-group</span>
                                                                </div>
                                                                <i data-lucide="chevron-right" class="w-6 h-6 text-white"></i>
                                                            </a> -->
                                                            <!-- 1. [Modified] 네이버 패션타운 텍스트 박스 (버튼에서 수정됨: 링크/아이콘/호버효과 제거) -->
                                                                <!-- <div class="block bg-gray-600 p-4 rounded-xl shadow-lg text-white">
                                                                    <div>
                                                                        <span class="block text-sm text-gray-200 mt-1">트렌디한 패션 정보 및 뉴스들 게시 예정.</span>
                                                                        <span class="font-bold">[네이버 최신 패션] 클릭</span>
                                                                        <span class="block text-sm text-cyan-200 mt-1">https://shopping.naver.com/window/main/fashion-group</span>
                                                                    </div>
                                                                </div> -->
                                                            <!-- [Added] 버튼 사이 간격 추가 (2줄 정도의 여백) -->
                                                            <div class="h-10"></div>
                                                                <!-- 2. 여성동아 패션 채널 링크 버튼 (보라-시안 그라데이션 배경, 링크 활성화) -->
                                                            <!-- <a href="https://woman.donga.com/fashion" target="_blank" class="block bg-gradient-to-r from-purple-600 to-cyan-500 hover:from-purple-700 hover:to-cyan-600 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-cyan-500/50 p-4 rounded-xl flex items-center justify-between text-white">
                                                                <div>
                                                                    <span class="font-bold">트랜디한 패션 정보 및 뉴스[여성동아 패션 채널] 클릭</span>
                                                                    <span class="block text-sm text-cyan-200 mt-1">https://woman.donga.com/fashion</span>
                                                                </div>
                                                                <i data-lucide="chevron-right" class="w-6 h-6 text-white"></i>
                                                            </a>                                                                                -->
                                                                                                        </div>                    </div>

                    <!-- 탭 2: Create (나만의 AI 코디 생성) -->
                    <div id="create-coordi" class="tab-page hidden">
                        <div class="bg-indigo-900/40 rounded-2xl p-6 border border-indigo-500/30 shadow-xl">
                            <h2 class="text-2xl font-bold mb-2 text-center text-cyan-400">AI Stylist Studio</h2>
                            <p class="text-center text-gray-300 mb-8 text-sm">내 사진에 새로운 스타일을 입혀보세요.</p>
                            <div class="flex flex-col gap-8">
                                <!-- 입력 섹션 1: 이미지 업로드 & 성별 선택 -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                    <!-- 이미지 업로드 -->
                                    <div class="flex flex-col h-full">
                                        <label class="flex items-center gap-2 text-lg font-bold mb-3 text-purple-300">
                                            <span class="flex items-center justify-center w-6 h-6 rounded-full bg-purple-600 text-xs text-white">1</span>
                                            내 사진 업로드
                                        </label>
                                        <div class="upload-area flex-grow rounded-xl flex items-center justify-center cursor-pointer h-[400px] relative overflow-hidden" onclick="document.getElementById('file-input').click()">
                                            <input type="file" id="file-input" accept="image/*" class="hidden" onchange="previewImage(event)">
                                            <img id="image-preview" class="hidden absolute inset-0 w-full h-full object-contain z-10" alt="미리보기">
                                            <div id="upload-placeholder" class="text-center z-0">
                                                <i data-lucide="image-plus" class="w-10 h-10 text-cyan-300 mb-2"></i>
                                                <p class="text-white font-medium">자신의 얼굴, 반신샷 선택</p>
                                                <p class="text-white font-medium">클릭하여 사진 업로드</p>
                                                <p class="text-gray-400 text-sm mt-1">JPG, PNG (Max 5MB)</p>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 성별 & 프롬프트 입력 -->
                                    <div class="flex flex-col gap-6">
                                        <!-- 성별 선택 -->
                                        <div>
                                            <label class="flex items-center gap-2 text-lg font-bold mb-3 text-purple-300">
                                                <span class="flex items-center justify-center w-6 h-6 rounded-full bg-purple-600 text-xs text-white">2</span>
                                                모델 성별 선택
                                            </label>
                                            <div class="grid grid-cols-3 gap-3">
                                                <!-- 여성 -->
                                                <div>
                                                    <input type="radio" id="gender-female" name="gender" value="Female model" class="gender-radio hidden" checked>
                                                    <label for="gender-female" class="flex flex-col items-center justify-center py-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 cursor-pointer">
                                                        <i data-lucide="user" class="w-5 h-5 mb-1"></i><span class="text-sm">여성</span>
                                                    </label>
                                                </div>
                                                <!-- 남성 -->
                                                <div>
                                                    <input type="radio" id="gender-male" name="gender" value="Male model" class="gender-radio hidden">
                                                    <label for="gender-male" class="flex flex-col items-center justify-center py-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 cursor-pointer">
                                                        <i data-lucide="user" class="w-5 h-5 mb-1"></i><span class="text-sm">남성</span>
                                                    </label>
                                                </div>
                                                <!-- 공용 -->
                                                <div>
                                                    <input type="radio" id="gender-unisex" name="gender" value="Unisex fashion model" class="gender-radio hidden">
                                                    <label for="gender-unisex" class="flex flex-col items-center justify-center py-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 cursor-pointer">
                                                        <i data-lucide="users" class="w-5 h-5 mb-1"></i><span class="text-sm">공용</span>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- 스타일 설명 (프롬프트) -->
                                        <div class="flex-grow flex flex-col">
                                            <label class="flex items-center gap-2 text-lg font-bold mb-3 text-purple-300">
                                                <span class="flex items-center justify-center w-6 h-6 rounded-full bg-purple-600 text-xs text-white">3</span>
                                                스타일 설명
                                            </label>
                                            <textarea id="style-prompt" class="w-full h-full min-h-[150px] p-4 rounded-xl login-input" placeholder="예: 빈티지, 카페(데이트), 휴양지(해변), 초현실적인 디테일, 풀샷 스타일"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <!-- 입력 섹션 2: 상세 옵션 선택 -->
                                <div>
                                    <label class="flex items-center gap-2 text-lg font-bold mb-3 text-purple-300">
                                        <span class="flex items-center justify-center w-6 h-6 rounded-full bg-purple-600 text-xs text-white">4</span>
                                        상세 옵션 선택 (클릭하여 추가)
                                    </label>
                                    <div id="prompt-options-container" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <!-- JavaScript에 의해 동적으로 채워짐 -->
                                    </div>
                                </div>
                                <!-- AI 생성 버튼 -->
                                <button id="generate-button" onclick="generateCoordi()" class="w-full py-4 font-bold rounded-xl cyan-button" disabled>
                                    AI 코디 생성하기
                                </button>
                                <!-- <button onclick="navigateTo('mypage')" class="p-4 px-8 font-bold rounded-xl cyan-button text-lg">
                                            나의 페이지 ->
                                </button> -->
                            </div>
                            <!-- 결과 표시 영역 -->
                            <div id="result-area" class="mt-12 hidden border-t border-indigo-500/30 pt-10">
                                <h3 class="text-2xl font-bold text-white mb-6 text-center">Creation Result</h3>
                                <!-- 로딩 인디케이터 -->
                                <div id="loading-indicator" class="hidden text-center py-12">
                                    <div class="relative w-20 h-20 mx-auto animate-spin">
                                        <div class="absolute inset-0 rounded-full border-4 border-indigo-700"></div>
                                        <div class="absolute inset-0 rounded-full border-4 border-t-cyan-400"></div>
                                    </div>
                                    <p class="text-cyan-400 font-bold mt-4">AI가 스타일을 생성하고 있습니다...</p>
                                </div>
                                <!-- 결과 이미지 -->
                                <div id="result-container" class="hidden text-center">
                                    <img id="result-image" class="w-full h-auto object-cover rounded-xl shadow-2xl max-w-md mx-auto" alt="결과 이미지">
                                    <button onclick="downloadResult()" class="mt-4 w-full max-w-md py-2 bg-white text-black font-bold rounded-lg hover:bg-gray-200">
                                        이미지 저장하기
                                    </button>
                                    <!-- <button onclick="navigateTo('mypage')" class="p-4 px-8 font-bold rounded-xl cyan-button text-lg">
                                            나의 페이지 ->
                                    </button> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 탭 3: Trendy (결과물 리스트) -->
                    <div id="results" class="tab-page hidden p-8 text-center bg-indigo-900/40 rounded-xl shadow-inner">
                        <p class="text-xl text-gray-300">결과물 콘솔 탭입니다. 생성된 코디 결과 이미지들을 보여주는 갤러리 기능을 여기에 구현할 예정입니다.</p>
                        <button class="mt-4 p-3 bg-fuchsia-600 rounded-xl hover:bg-fuchsia-700 font-bold">내 결과물 보기</button>
                    </div>
                </div>

                <!-- 페이지 이동 버튼 -->
                <!-- <section class="mt-12 text-center">
                    <button onclick="goToCreateCoordi()" class="p-4 px-8 font-bold rounded-xl cyan-button text-lg">
                         나만의 코디 생성하러 가기
                    </button>
                </section> -->
                <!-- 페이지 이동 버튼 -->
                <!-- <section class="mt-12 text-center">
                    <button onclick="goToCreateCoordi()" class="p-4 px-8 font-bold rounded-xl cyan-button text-lg">
                         나만의 코디 생성하러 가기
                    </button>
                </section> -->
                 <!-- [수정된 부분] 페이지 이동 버튼 그룹: 모든 버튼 사이즈(flex-1, h-24) 동일하게 통일 -->
                <!-- <section class="mt-12">
                    <div class="flex flex-wrap justify-center items-stretch gap-3 sm:gap-4 max-w-4xl mx-auto">
                        1. 라이브러리: flex-1, h-24 적용
                        <button onclick="navigateTo('results'); setActiveTab('results')" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                            <i data-lucide="library" class="w-6 h-6 mb-2 text-gray-300"></i>
                            <span class="text-xs sm:text-sm text-gray-300 font-bold">라이브러리</span>
                        </button>

                        2. 홈: flex-1, h-24 적용
                        <button onclick="navigateTo('trend')" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                            <i data-lucide="home" class="w-6 h-6 mb-2 text-gray-300"></i>
                            <span class="text-xs sm:text-sm text-gray-300 font-bold">홈</span>
                        </button>

                        3. 코디 생성하기: flex-[2] -> flex-1 변경하여 크기 동일화, h-24 적용
                        <button onclick="goToCreateCoordi()" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                            <i data-lucide="shirt" class="w-6 h-6 mb-2 text-gray-300"></i>
                            <span class="text-xs sm:text-sm text-gray-300 font-bold">코디 생성</span>
                        </button>

                        4. 마이페이지: flex-1, h-24 적용
                        <button onclick="navigateTo('mypage')" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                            <i data-lucide="user" class="w-6 h-6 mb-2 text-gray-300"></i>
                            <span class="text-xs sm:text-sm text-gray-300 font-bold">마이페이지</span>
                        </button>
                    </div>
                </section>
            </div>
            
            <!-- 페이지 섹션 2: 마이 페이지 -->
            <div id="mypage" class="page-section hidden p-8 bg-indigo-900/40 rounded-xl shadow-2xl">
                <h2 class="text-4xl font-extrabold mb-8 text-cyan-400">My Page</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12 border-b border-indigo-500/50 pb-6">
                    <div class="font-bold text-lg text-gray-300">이름</div>
                    <div class="md:col-span-2 text-xl font-medium text-white">@@@</div>
                    <div class="font-bold text-lg text-gray-300">이메일</div>
                    <div class="md:col-span-2 text-xl font-medium text-white">abc12345@gmail.com</div>
                    <div class="font-bold text-lg text-gray-300">플랜</div>
                    <div class="md:col-span-2 text-xl font-medium text-white">Basic</div>
                </div>
                <h3 class="text-2xl font-bold mb-6 border-b border-cyan-400/50 pb-2">생성 이력 영상</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="rounded-xl overflow-hidden shadow-lg border border-indigo-500/50">
                        <img src="https://placehold.co/400x400/312e81/ffffff?text=Generated+Image+1" alt="생성이미지 1" class="w-full history-image">
                        <div class="p-3 text-sm text-center bg-indigo-900/70">Urban Chic Style</div>
                    </div>
                    <div class="rounded-xl overflow-hidden shadow-lg border border-indigo-500/50">
                        <img src="https://placehold.co/400x400/312e81/ffffff?text=Generated+Image+2" alt="생성이미지 2" class="w-full history-image">
                        <div class="p-3 text-sm text-center bg-indigo-900/70">Street Vibe</div>
                    </div>
                    <div class="rounded-xl overflow-hidden shadow-lg border border-indigo-500/50">
                        <img src="https://placehold.co/400x400/312e81/ffffff?text=Generated+Image+3" alt="생성이미지 3" class="w-full history-image">
                        <div class="p-3 text-sm text-center bg-indigo-900/70">Vintage Mood</div>
                    </div>
                </div>
                <!-- <section class="mt-12">
                    <div class="flex flex-wrap justify-center items-stretch gap-3 sm:gap-4 max-w-4xl mx-auto">
                        1. 라이브러리: flex-1, h-24 적용
                        <button onclick="navigateTo('results'); setActiveTab('results')" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                            <i data-lucide="library" class="w-6 h-6 mb-2 text-gray-300"></i>
                            <span class="text-xs sm:text-sm text-gray-300 font-bold">라이브러리</span>
                        </button>

                        2. 홈: flex-1, h-24 적용
                        <button onclick="navigateTo('trend')" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                            <i data-lucide="home" class="w-6 h-6 mb-2 text-gray-300"></i>
                            <span class="text-xs sm:text-sm text-gray-300 font-bold">홈</span>
                        </button>

                        3. 코디 생성하기: flex-[2] -> flex-1 변경하여 크기 동일화, h-24 적용
                        <button onclick="goToCreateCoordi()" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                            <i data-lucide="shirt" class="w-6 h-6 mb-2 text-gray-300"></i>
                            <span class="text-xs sm:text-sm text-gray-300 font-bold">코디 생성</span>
                        </button>

                        4. 마이페이지: flex-1, h-24 적용
                        <button onclick="navigateTo('mypage')" class="flex-1 min-w-[70px] h-24 flex flex-col items-center justify-center p-2 bg-gray-800/50 hover:bg-indigo-600/50 rounded-xl border border-white/10 transition-all">
                            <i data-lucide="user" class="w-6 h-6 mb-2 text-gray-300"></i>
                            <span class="text-xs sm:text-sm text-gray-300 font-bold">마이페이지</span>
                        </button>
                    </div>
                </section>
                </div>
            </div>
            
                <!-- 페이지 섹션 3: AI 소개 (수정된 부분) -->
            <div id="ai" class="page-section hidden p-8 bg-indigo-900/40 rounded-xl shadow-2xl relative overflow-hidden">
                <!-- 배경 장식 요소 -->
                <div class="absolute top-0 right-0 p-10 opacity-10 pointer-events-none">
                    <i data-lucide="cpu" class="w-64 h-64 text-cyan-500"></i>
                </div>
                
                <div class="relative z-10 text-center mb-12">
                    <h2 class="text-4xl font-extrabold mb-6 text-cyan-400 neon-text">AI Tech Behind LOUD</h2>
                    <p class="text-gray-300 text-lg leading-relaxed max-w-3xl mx-auto">
                        단 한 장의 사진으로 시작되는 무한한 패션의 세계.<br>
                        Google Gemini의 최신 이미지 생성 모델이 당신의 상상을 현실로 만듭니다.
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 relative z-10 mb-12">
                    <!-- Feature 1 -->
                    <div class="bg-black/20 p-8 rounded-2xl border border-indigo-500/30 hover:border-cyan-400 transition duration-300 hover:transform hover:-translate-y-2 group">
                        <div class="w-16 h-16 bg-indigo-600/50 rounded-2xl flex items-center justify-center mb-6 mx-auto group-hover:bg-indigo-600 transition duration-300">
                            <i data-lucide="sparkles" class="w-8 h-8 text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-3 text-center text-cyan-200">Generative Style Transfer</h3>
                        <!-- 수정: 전문적인 설명 -> 쉬운 설명 -->
                        <p class="text-gray-400 text-sm text-center leading-relaxed">
                            사진 위에 옷을 단순히 오려 붙이는 게 아니에요. 마치 내가 실제로 그 옷을 입고 찍은 것처럼, 옷의 주름과 재질까지 아주 자연스럽게 만들어줍니다.
                        </p>
                    </div>

                    <!-- Feature 2 -->
                    <div class="bg-black/20 p-8 rounded-2xl border border-indigo-500/30 hover:border-cyan-400 transition duration-300 hover:transform hover:-translate-y-2 group">
                        <div class="w-16 h-16 bg-purple-600/50 rounded-2xl flex items-center justify-center mb-6 mx-auto group-hover:bg-purple-600 transition duration-300">
                            <i data-lucide="scan-face" class="w-8 h-8 text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-3 text-center text-cyan-200">Identity Preservation</h3>
                        <!-- 수정: 전문적인 설명 -> 쉬운 설명 -->
                        <p class="text-gray-400 text-sm text-center leading-relaxed">
                            옷을 갈아입혀도 내 얼굴이 다른 사람처럼 변할까 걱정하지 마세요. AI가 내 눈, 코, 입을 정확히 알아보고 내 얼굴 그대로 유지해줍니다.
                        </p>
                    </div>

                    <!-- Feature 3 -->
                    <div class="bg-black/20 p-8 rounded-2xl border border-indigo-500/30 hover:border-cyan-400 transition duration-300 hover:transform hover:-translate-y-2 group">
                        <div class="w-16 h-16 bg-cyan-600/50 rounded-2xl flex items-center justify-center mb-6 mx-auto group-hover:bg-cyan-600 transition duration-300">
                            <i data-lucide="wand-2" class="w-8 h-8 text-white"></i>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-3 text-center text-cyan-200">Context Awareness</h3>
                        <!-- 수정: 전문적인 설명 -> 쉬운 설명 -->
                        <p class="text-gray-400 text-sm text-center leading-relaxed">
                            옷만 덩그러니 바뀌면 어색하겠죠? '해변', '카페' 같은 장소만 정해주세요. 그 옷에 딱 어울리는 배경과 조명까지 AI가 알아서 척척 꾸며줍니다.
                        </p>
                    </div>
                </div>

                <div class="text-center relative z-10">
                    <!-- 수정: 버튼 텍스트 및 이동 경로 (생성 페이지 -> 메인 페이지) -->
                    <button onclick="navigateTo('trend')" class="p-4 px-12 font-bold rounded-xl cyan-button text-lg shadow-lg hover:shadow-cyan-500/50 transition flex items-center gap-2 mx-auto">
                        <span>메인 페이지로 가기</span>
                        <i data-lucide="home" class="w-5 h-5"></i>
                    </button>
                    <p class="mt-4 text-gray-500 text-sm">Powered by Google Gemini</p>
                </div>
            </div>

    <!-- 알림 모달: showAlert() 함수를 통해 제어됨 -->
    <div id="custom-alert" class="fixed top-5 right-5 z-50 transform translate-x-full transition-transform duration-300">
        <div class="bg-indigo-900/90 border border-cyan-500/50 text-white px-6 py-4 rounded-xl shadow-2xl flex items-center gap-3 backdrop-blur-md">
            <i data-lucide="info" class="w-6 h-6 text-cyan-400"></i>
            <span id="alert-msg" class="font-medium">Message</span>
        </div>
    </div>

    <script>
        // --- 전역 상수 및 변수 ---
        const API_KEY = "AIzaSyCvLevOs3B-NXMDtUNwZhavPBah37XEFm8"; // Gemini API 키 (실제 배포 시에는 안전하게 관리 필요)
        const IMAGE_GEN_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${API_KEY}`;
        let currentPage = 'trend'; // 현재 활성화된 페이지 ID
        
        // --- 프롬프트 데이터 ---
        // AI에게 전달할 프롬프트의 각 옵션을 정의합니다.
        // label: 사용자에게 보여질 한글 텍스트
        // value: 실제 API에 전달될 영문 프롬프트 값
        const promptData = [
            {
                category: "👗 패션 스타일 & 코디",
                items: [
                    { label: "캐주얼", value: "Casual style" },
                    { label: "미니멀", value: "Minimalist fashion" },
                    { label: "스트릿", value: "Streetwear" },
                    { label: "빈티지", value: "Vintage fashion" },
                    { label: "클래식", value: "Classic style" },
                    { label: "스포티", value: "Sporty look" },
                    { label: "고프코어", value: "Gorpcore" },
                    { label: "그런지", value: "Grunge style" },
                    { label: "프레피", value: "Preppy look" },
                    { label: "로맨틱", value: "Romantic style" },
                    { label: "비즈니스 캐주얼", value: "Business casual" }
                ]
            },
            {
                category: "📷 카메라 위치와 구도 (Shot Type)",
                items: [
                    { label: "전신", value: "Full body shot, wide shot" },
                    // { label: "롱 샷 (원거리)", value: "Long shot, far view" },
                    // { label: "익스트림 롱 샷", value: "Extreme long shot, vast background" },
                    { label: "무릎 위", value: "Knee shot, 3/4 shot, from knees up" },
                    { label: "허리 위", value: "Waist shot, medium shot, from waist up" },
                    { label: "가슴 위", value: "Bust shot, chest up" },
                    // { label: "클로즈업 (얼굴)", value: "Close-up shot of face" },
                    { label: "익스트림 클로즈업", value: "Extreme close-up, detailed eyes" },
                    { label: "숄더 샷", value: "Over the shoulder shot" },
                    { label: "정면", value: "Front view, facing camera" },
                    { label: "측면 ", value: "Side profile view" },
                    { label: "45도 측면", value: "Three-quarter view, 45-degree angle" },
                    { label: "뒷면 ", value: "Back view, from behind" },
                    { label: "낮은 시선", value: "Low angle shot, looking up" },
                    { label: "높은 시선", value: "High angle shot, looking down" }
                ]
            },
            {
                category: "📍 장소 및 상황 (TPO)",
                items: [
                    { label: "예식장", value: "Wedding guest look, Wedding hall background" },
                    { label: "쇼핑몰", value: "Shopping mall background, Shopping outfit" },
                    { label: "카페", value: "Cafe date outfit, Cafe background" },
                    { label: "친구 만남", value: "Hangout with friends, Casual street background" },
                    { label: "사무실", value: "Office wear, Modern office background" },
                    { label: "피트니스", value: "Gym wear, Fitness center background" },
                    { label: "공항 패션", value: "Airport fashion, Airport terminal background" },
                    { label: "휴양지, 해변", value: "Beach resort wear, Sunny beach background" },
                    { label: "캠퍼스", value: "University campus background, College student look" }
                ]
            },
            {
                category: "🌤️ 날씨 및 계절",
                items: [
                    { label: "화창한", value: "Sunny day, Clear blue sky, Bright lighting" },
                    { label: "흐린", value: "Cloudy day, Overcast sky, Soft lighting" },
                    { label: "비오는", value: "Rainy day, Wet streets, Holding an umbrella" },
                    { label: "눈 내리는", value: "Snowy day, Winter fashion, Snow background" },
                    { label: "바람 부는", value: "Windy day, Hair blowing in wind" },
                    { label: "봄", value: "Spring season, Cherry blossoms background" },
                    { label: "가을", value: "Autumn season, Falling leaves background" },
                    { label: "해질녘", value: "Golden hour, Sunset lighting" }
                ]
            },
            {
                category: "✨ 화질 및 퀄리티",
                items: [
                    { label: "사진(현실감)", value: "Photorealistic" },
                    { label: "초현실적인", value: "Hyper-realistic" },
                    { label: "초고해상도", value: "8k_resolution" },
                    { label: "정밀한 묘사", value: "Highly_detailed" },
                    { label: "걸작", value: "Masterpiece" }
                ]
            }
        ];

        // 빠른 조회를 위해 한글 라벨을 영문 값으로 변환하는 맵을 생성합니다.
        const labelToValueMap = {};
        promptData.forEach(section => {
            if (section.isGrouped) {
                section.groups.forEach(group => group.items.forEach(item => { labelToValueMap[item.label] = item.value; }));
            } else {
                section.items.forEach(item => { labelToValueMap[item.label] = item.value; });
            }
        });

        // --- 유틸리티 함수 ---

        /**
         * File 객체를 Base64 문자열로 변환합니다.
         * @param {File} file - 변환할 파일 객체.
         * @returns {Promise<string>} Base64로 인코딩된 이미지 데이터.
         */
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]); 
                reader.onerror = error => reject(error);
            });
        }

        /**
         * 화면 우측 상단에 커스텀 알림 메시지를 표시합니다.
         * @param {string} msg - 표시할 메시지.
         */
        function alertMessage(msg) {
            const alertBox = document.getElementById('custom-alert');
            const alertMsg = document.getElementById('alert-msg');
            if (alertBox && alertMsg) {
                alertMsg.textContent = msg;
                alertBox.classList.remove('translate-x-full');
                setTimeout(() => alertBox.classList.add('translate-x-full'), 3000);
            }
        }

        // --- UI 렌더링 및 이벤트 처리 함수 ---

        /**
         * 'promptData'를 기반으로 상세 옵션 UI(아코디언 메뉴와 칩)를 생성합니다.
         */
        function renderPromptOptions() {
            const container = document.getElementById('prompt-options-container');
            if (!container) return;
            container.innerHTML = ''; 

            promptData.forEach((section, index) => {
                const details = document.createElement('details');
                details.className = "group border border-indigo-500/30 rounded-xl bg-indigo-900/20 overflow-hidden";
                if(index === 0) details.open = true; // 첫 번째 섹션은 기본적으로 열어둠

                const summary = document.createElement('summary');
                summary.className = "flex items-center justify-between p-4 text-sm font-bold text-indigo-200 hover:bg-white/5 transition select-none";
                summary.innerHTML = `<span class="flex items-center gap-2">${section.category}</span><i data-lucide="chevron-down" class="w-4 h-4 transition-transform group-open:rotate-180"></i>`;

                const contentDiv = document.createElement('div');
                contentDiv.className = "p-4 border-t border-indigo-500/30 bg-black/20 flex flex-wrap gap-2";

                if (section.isGrouped) {
                    section.groups.forEach(group => {
                        const groupTitle = document.createElement('div');
                        groupTitle.className = "w-full text-xs text-cyan-400 mt-2 mb-1 font-bold";
                        groupTitle.textContent = group.name;
                        contentDiv.appendChild(groupTitle);
                        group.items.forEach(item => contentDiv.appendChild(createChip(item)));
                    });
                } else {
                    section.items.forEach(item => contentDiv.appendChild(createChip(item)));
                }

                details.appendChild(summary);
                details.appendChild(contentDiv);
                container.appendChild(details);
            });
            
            lucide.createIcons(); 
        }

        /**
         * 클릭 가능한 프롬프트 칩(버튼)을 생성합니다.
         * @param {object} item - { label, value } 형태의 프롬프트 아이템.
         * @returns {HTMLButtonElement} 생성된 버튼 엘리먼트.
         */
        function createChip(item) {
            const btn = document.createElement('button');
            btn.className = "option-chip";
            btn.textContent = item.label;
            
            btn.onclick = () => {
                const textArea = document.getElementById('style-prompt');
                if (!textArea) return;
                let currentText = textArea.value.trim();
                
                // 텍스트 필드에 콤마로 구분하여 추가
                if (currentText.length > 0 && !currentText.endsWith(',')) {
                    textArea.value = currentText + ", " + item.label;
                } else {
                    textArea.value = currentText + (currentText.length > 0 ? " " : "") + item.label;
                }
                
                textArea.focus();
                btn.classList.add('selected'); // 클릭 피드백
                setTimeout(() => btn.classList.remove('selected'), 300);
            };
            return btn;
        }

        /**
         * 파일 입력 시 이미지를 미리 보여줍니다.
         * @param {Event} event - 파일 input의 change 이벤트.
         */
        function previewImage(event) {
            const file = event.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('image-preview').src = e.target.result;
                    document.getElementById('image-preview').classList.remove('hidden');
                    document.getElementById('upload-placeholder').classList.add('hidden');
                    document.getElementById('generate-button').disabled = false;
                };
                reader.readAsDataURL(file);
            }
        }

        // --- 핵심 애플리케이션 로직 ---

        /**
         * 페이지 네비게이션을 처리합니다. (SPA처럼 동작)
         * @param {string} targetPage - 보여줄 페이지의 ID.
         */
        function navigateTo(targetPage) {
            console.log(`[navigateTo] Target page: ${targetPage}`);
            currentPage = targetPage;
            document.querySelectorAll('.page-section').forEach(section => {
                if (section.id === targetPage) {
                    section.classList.remove('hidden');
                    console.log(`[navigateTo] Showing section: ${section.id}`);
                } else {
                    section.classList.add('hidden');
                    console.log(`[navigateTo] Hiding section: ${section.id}`);
                }
            });
            if (targetPage === 'trend') initializeTabs(); 
            lucide.createIcons();
        }

        /**
         * 탭 UI를 초기화하고 활성 탭 인디케이터 위치를 설정합니다.
         */
        function initializeTabs() {
            console.log('[initializeTabs] Initializing tabs for trend section.');
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabIndicator = document.getElementById('tab-indicator');
            const initialButton = document.querySelector('.tab-button[data-tab="trend-feed"]');

            if (initialButton && tabIndicator) {
                const rect = initialButton.getBoundingClientRect();
                const parentRect = initialButton.closest('#tabs').getBoundingClientRect();
                tabIndicator.style.transition = 'none'; 
                tabIndicator.style.left = `${rect.left - parentRect.left}px`;
                tabIndicator.style.width = `${rect.width}px`;
                setTimeout(() => { tabIndicator.style.transition = 'left 0.3s ease, width 0.3s ease'; }, 50);
                setActiveTab('trend-feed');
            }
        }
        
        /**
         * 특정 탭을 활성화하고 해당 콘텐츠를 보여줍니다.
         * @param {string} tabId - 활성화할 탭의 ID.
         */
        function setActiveTab(tabId) {
            console.log(`[setActiveTab] Activating tab: ${tabId}`);
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabIndicator = document.getElementById('tab-indicator');
            const tabPages = document.querySelectorAll('.tab-page');
            
            tabPages.forEach(page => {
                if (page.id === tabId) {
                    page.classList.remove('hidden');
                    console.log(`[setActiveTab] Showing tab page: ${page.id}`);
                } else {
                    page.classList.add('hidden');
                    console.log(`[setActiveTab] Hiding tab page: ${page.id}`);
                }
            });

            if (tabIndicator) {
                tabButtons.forEach(button => {
                    const isActive = button.getAttribute('data-tab') === tabId;
                    // Remove existing background classes
                    button.classList.remove('bg-gray-500', 'bg-gray-400', 'bg-gray-300');
                    button.classList.remove('hover:bg-gray-500'); // Remove hover for inactive states initially
                    button.classList.add('text-white'); // Ensure text is white

                    if (isActive) {
                        const rect = button.getBoundingClientRect();
                        const parentRect = button.closest('#tabs').getBoundingClientRect();
                        tabIndicator.style.left = `${rect.left - parentRect.left}px`;
                        tabIndicator.style.width = `${rect.width}px`;
                        tabIndicator.style.backgroundColor = '#808080'; // Set line color for active tab
                        button.classList.add('bg-gray-500'); // Active tab color
                    } else {
                        // Set inactive colors based on data-tab
                        const dataTab = button.getAttribute('data-tab');
                        if (dataTab === 'trend-feed') {
                            button.classList.add('bg-gray-400', 'hover:bg-gray-500'); // OOTD when inactive
                        } else if (dataTab === 'beginner') {
                            button.classList.add('bg-gray-400', 'hover:bg-gray-500'); // Beginner when inactive
                        } else if (dataTab === 'results') {
                            button.classList.add('bg-gray-300', 'hover:bg-gray-500'); // Trendy when inactive
                        }
                    }
                });
            }
            lucide.createIcons();
        }

        /**
         * 'Create' 탭으로 바로 이동합니다.
         */
        function goToCreateCoordi() {
            navigateTo('trend');
            setActiveTab('create-coordi');
            window.scrollTo(0, 0);
        }

        /**
         * 입력된 정보를 바탕으로 Gemini API에 이미지 생성을 요청합니다.
         */
        async function generateCoordi() {
            const rawPrompt = document.getElementById('style-prompt').value.trim();
            const fileInput = document.getElementById('file-input');
            const genderValue = document.querySelector('input[name="gender"]:checked').value;
            
            if(!fileInput.files[0] || !rawPrompt) {
                alertMessage("이미지와 스타일 설명을 모두 입력해주세요.");
                return;
            }

            // 1. 프롬프트 조합: (성별) + (사용자 입력)
            let finalPrompt = `${genderValue}, ${rawPrompt}`;
            
            // 2. 프롬프트 변환: 한글 키워드를 영문으로 변경
            Object.keys(labelToValueMap).forEach(label => {
                finalPrompt = finalPrompt.replaceAll(label, labelToValueMap[label]);
            });

            // 3. 얼굴 보존 지시사항 추가 (결과물 퀄리티에 중요)
            const facePreservationInstruction = "Based on the input image, change the clothing, style, and background as described, but you MUST preserve the person's face, facial features, and identity exactly as they are in the input image. ";
            finalPrompt = facePreservationInstruction + finalPrompt;

            // UI를 로딩 상태로 변경
            const loading = document.getElementById('loading-indicator');
            const resultArea = document.getElementById('result-area');
            const resultContainer = document.getElementById('result-container');
            const btn = document.getElementById('generate-button');

            try {
                resultArea.classList.remove('hidden');
                loading.classList.remove('hidden');
                resultContainer.classList.add('hidden');
                btn.disabled = true;
                resultArea.scrollIntoView({ behavior: 'smooth' });

                // 4. API 호출
                const base64Img = await fileToBase64(fileInput.files[0]);
                const response = await fetch(IMAGE_GEN_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [ { text: finalPrompt }, { inlineData: { mimeType: fileInput.files[0].type || "image/jpeg", data: base64Img } } ] }],
                        generationConfig: { responseModalities: ["IMAGE"] }
                    })
                });

                if(!response.ok) throw new Error(`서버 요청 실패 (${response.status})`);

                const data = await response.json();
                const resultBase64 = data.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;

                // 5. 결과 표시
                if(resultBase64) {
                    document.getElementById('result-image').src = `data:image/png;base64,${resultBase64}`;
                    loading.classList.add('hidden');
                    resultContainer.classList.remove('hidden');
                } else {
                    throw new Error("API 응답에서 이미지를 찾을 수 없습니다.");
                }

            } catch (e) {
                console.error("오류 발생:", e);
                loading.classList.add('hidden');
                alertMessage("오류: " + e.message);
            } finally {
                btn.disabled = false; // 버튼 다시 활성화
            }
        }

        /**
         * 생성된 이미지를 다운로드합니다.
         */
        function downloadResult() {
            const link = document.createElement('a');
            link.href = document.getElementById('result-image').src;
            link.download = 'ai-stylist-result.png';
            link.click();
        }

        let currentZoomedElement = null; // 현재 확대된 이미지 요소를 추적

        function toggleZoom(element) {
            // 현재 확대된 이미지가 있고, 클릭된 요소와 다르면 이전 확대된 이미지를 축소
            if (currentZoomedElement && currentZoomedElement !== element) {
                currentZoomedElement.classList.remove('scale-125', 'z-20');
                currentZoomedElement.classList.add('hover:scale-[1.02]');
            }

            // 클릭된 요소의 확대/축소 토글
            element.classList.toggle('scale-125');
            element.classList.toggle('z-20'); // 확대될 때 다른 요소 위에 오도록 z-index 증가
            element.classList.toggle('hover:scale-[1.02]'); // 확대되면 hover 효과는 제거

            // 현재 확대된 요소 업데이트
            if (element.classList.contains('scale-125')) {
                currentZoomedElement = element;
            } else {
                currentZoomedElement = null;
            }
        }

        // [수정됨] 별(저장) 아이콘 토글 함수: <i> 태그가 <svg>로 변환되는 것을 고려하여 수정
        function toggleStar(event, button) {
            event.stopPropagation(); // 부모 요소의 toggleZoom 이벤트 전파 방지
            // Lucide 라이브러리가 <i> 태그를 <svg> 태그로 변환하므로, 두 경우 모두를 체크합니다.
            const icon = button.querySelector('svg') || button.querySelector('i');
            
            if (!icon) return;

            // svg의 경우 fill 속성값이 'none' 또는 없을 수 있음
            if (icon.getAttribute('fill') === 'none' || !icon.getAttribute('fill')) {
                icon.setAttribute('fill', 'currentColor');
                icon.classList.remove('text-white', 'group-hover/star:text-yellow-400');
                icon.classList.add('text-yellow-400');
            } else {
                icon.setAttribute('fill', 'none');
                icon.classList.remove('text-yellow-400');
                icon.classList.add('text-white', 'group-hover/star:text-yellow-400');
            }
        }

        // [수정됨] 하트(좋아요) 아이콘 토글 및 숫자 변경 함수: <i> 태그가 <svg>로 변환되는 것을 고려하여 수정
        function toggleHeart(event, button) {
            event.stopPropagation(); // 부모 요소의 toggleZoom 이벤트 전파 방지
            const icon = button.querySelector('svg') || button.querySelector('i');
            const countSpan = button.querySelector('span');
            
            if (!icon || !countSpan) return;

            let count = parseInt(countSpan.textContent.replace(/,/g, ''));

            if (icon.getAttribute('fill') === 'none' || !icon.getAttribute('fill')) {
                icon.setAttribute('fill', 'currentColor');
                icon.classList.remove('text-white', 'group-hover/heart:text-red-500');
                icon.classList.add('text-red-500');
                count++;
            } else {
                icon.setAttribute('fill', 'none');
                icon.classList.remove('text-red-500');
                icon.classList.add('text-white', 'group-hover/heart:text-red-500');
                count--;
            }
            countSpan.textContent = count;
        }

        // --- 페이지 초기화 ---

        /**
         * DOM이 로드된 후 실행될 초기화 로직입니다.
         */
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons(); // 아이콘 렌더링
            navigateTo('trend'); // 초기 페이지 설정
            
            // 탭 버튼 클릭 이벤트 리스너 설정
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    setActiveTab(button.getAttribute('data-tab'));
                });
            });

            // 창 크기 변경 시 탭 인디케이터 재조정
            window.addEventListener('resize', initializeTabs);
            
            // 초기화 함수 호출
            initializeTabs();
            renderPromptOptions(); // 상세 옵션 UI 렌더링
        });
        
    </script>
</body>
</html>
